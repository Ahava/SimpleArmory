"use strict";var simpleArmoryApp=angular.module("simpleArmoryApp",["ngRoute","simpleArmoryControllers","simpleArmoryFilters","simpleArmoryServices","ui.bootstrap"]);simpleArmoryApp.config(["$routeProvider",function(a){a.when("/:region/:realm/:character/achievements/:category",{templateUrl:"views/achievements.html",controller:"AchievementsCtrl"}).when("/:region/:realm/:character/collectable/battlepets",{templateUrl:"views/battlePets.html",controller:"BattlePetsCtrl"}).when("/:region/:realm/:character/calendar",{templateUrl:"views/calendar.html",controller:"CalendarCtrl"}).when("/:region/:realm/:character/collectable/companions",{templateUrl:"views/companions.html",controller:"CompanionsCtrl"}).when("/:region/:realm/:character/collectable/mounts",{templateUrl:"views/mounts.html",controller:"MountsCtrl"}).when("/:region/:realm/:character",{templateUrl:"views/overview.html",controller:"OverviewCtrl"}).when("/:region/:realm/:character/reputation",{templateUrl:"views/reputation.html",controller:"ReputationCtrl"}).when("/",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/error",{templateUrl:"views/error.html",controller:"ErrorCtrl"}).otherwise({redirectTo:"/"})}]);var simpleArmoryControllers=angular.module("simpleArmoryControllers",[]);simpleArmoryControllers.controller("ApplicationController",["$scope","LoginService","$location","$filter",function(a,b,c,d){a.isLoggedIn=!1,a.$on("$locationChangeSuccess",function(){if("/error"===c.$$path)a.character=null,a.isLoggedIn=!1;else if(""!==c.$$path&&"/"!==c.$$path){var d=new RegExp("([^/]+)/([^/]+)/([^/]+)/?([^/]+)?").exec(c.$$path);d=d?d:{},b.getCharacter({region:d[1],realm:d[2],character:d[3]}).then(function(b){a.character=b[0],a.isLoggedIn=!0})}}),a.percent=function(a,b){return d("number")(a/b*100,0)},a.getImageSrc=function(a){return a.collected?"http://wow.zamimg.com/images/wow/icons/medium/"+a.icon.toLowerCase()+".jpg":"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="}}]),simpleArmoryControllers.controller("LoginCtrl",["$scope","$modal","$location",function(a,b,c){var d=b.open({templateUrl:"ModelLogin.html",controller:"ModalInstanceCtrl",backdrop:"static"});d.result.then(function(a){c.url(a.region+"/"+a.realm+"/"+a.character)})}]),simpleArmoryControllers.controller("ModalInstanceCtrl",["$scope","$modalInstance","BlizzardRealmService",function(a,b,c){a.realms=[{name:"Loading realms..."}],c.getRealms().then(function(b){a.realms=[],angular.forEach(b[0].data.realms,function(a){this.push({value:{realm:a.slug,region:"us"},text:a.name+" US"})},a.realms),angular.forEach(b[1].data.realms,function(a){this.push({value:{realm:a.slug,region:"eu"},text:a.name+" EU"})},a.realms)}),a.ok=function(){b.close({region:a.selectedRealm.region,realm:a.selectedRealm.realm,character:a.characterName})},a.marko=function(){b.close({region:"us",realm:"proudmoore",character:"marko"})}}]),simpleArmoryControllers.controller("OverviewCtrl",["$scope","AchievementsService",function(a,b){b.getAchievements().then(function(b){a.achievements=b})}]),simpleArmoryControllers.controller("HeaderCtrl",["$scope","$location",function(a,b){function c(a){return a?"/"+a.region.toLowerCase()+"/"+a.realm.toLowerCase()+"/"+a.name.toLowerCase():"#"}a.getUrl=function(b){var d="#"+c(a.character);return""!==b&&(d+="/"+b),d},a.isActive=function(d,e){if(e)return b.path().indexOf(d)>0;var f=c(a.character);return""!==d&&(f+="/"+d),b.path()===f},a.guildName=function(){return a.character&&a.character.guild?"<"+a.character.guild.name+">":""},a.imgUrl=function(){if(a.character){var b=a.character;return"http://"+b.region+".battle.net/static-render/"+b.region+"/"+b.thumbnail}return""},a.armoryUrl=function(){if(a.character){var b=a.character;return"http://"+b.region+".battle.net/wow/en/character/"+b.realm+"/"+b.name.toLowerCase()+"/advanced"}return"#"}}]),simpleArmoryControllers.controller("AchievementsCtrl",["$scope","AchievementsService","$routeParams",function(a,b,c){function d(a){var b=a;switch(a){case"general":b="General";break;case"quests":b="Quests";break;case"exploration":b="Exploration";break;case"pvp":b="Player vs. Player";break;case"dungeons":b="Dungeons & Raids";break;case"professions":b="Professions";break;case"reputation":b="Reputation";break;case"scenarios":b="Scenarios";break;case"events":b="World Events";break;case"pets":b="Pet Battles";break;case"feats":b="Feats of Strength"}return b}a.superCat=d(c.category),b.getAchievements().then(function(b){a.achievements=b[a.superCat]}),a.getImageSrc=function(a){return 8468===a.id?"images/galakras.png":a.completed?"http://wow.zamimg.com/images/wow/icons/medium/"+a.icon.toLowerCase()+".jpg":"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="},a.border=function(a){return a.completed?"borderOff":"borderOn"}}]),simpleArmoryControllers.controller("MountsCtrl",["$scope","MountsAndPetsService",function(a,b){b.getItems("mounts","mounts","spellId").then(function(b){a.items=b})}]),simpleArmoryControllers.controller("CompanionsCtrl",["$scope","MountsAndPetsService",function(a,b){b.getItems("pets","pets","spellId").then(function(b){a.items=b})}]),simpleArmoryControllers.controller("BattlePetsCtrl",["$scope","MountsAndPetsService",function(a,b){b.getItems("battlepets","pets","creatureId").then(function(b){a.items=b}),a.qualityToBackground=function(a){var b="#fff";switch(a.quality){case"poor":b="#7F7F7F";break;case"common":b="#F0F0F0";break;case"uncommon":b="#22B14C";break;case"rare":b="#3F48CC"}return"background:"+b}}]),simpleArmoryControllers.controller("CalendarCtrl",[function(){}]),simpleArmoryControllers.controller("ReputationCtrl",[function(){}]),simpleArmoryControllers.controller("ErrorCtrl",[function(){}]),angular.module("simpleArmoryFilters",[]);var simpleArmoryServices=angular.module("simpleArmoryServices",[]);simpleArmoryServices.factory("LoginService",["$location","$log","$http","$q",function(a,b,c,d){return{getCharacter:function(e){function f(){b.log("Trouble fetching character from battlenet"),a.url("error")}function g(a){return a.data.region=e.region,a.data.faction=[,"A","H","A","A","H","H","A","H","H","H","Alliance",,,,,,,,,,,"A",,,"A","H"][a.data.race],a.data}b.log("Fetching "+e.character+" from server "+e.realm+"...");var h=d.defer();setTimeout(function(){h.resolve("hello world"),h.resolve("hello world")},1);var i=c.jsonp("http://"+e.region+".battle.net/api/wow/character/"+e.realm+"/"+e.character+"?fields=pets,mounts,achievements,guild,reputation&jsonp=JSON_CALLBACK",{cache:!0}).error(f).then(g);return d.all([i,h.promise])}}}]),simpleArmoryServices.factory("BlizzardRealmService",["$http","$q","$log",function(a,b,c){return{getRealms:function(){c.log("Fetching server list for us...");var d=a.jsonp("http://us.battle.net/api/wow/realm/status?jsonp=JSON_CALLBACK");c.log("Fetching server list for eu...");var e=a.jsonp("http://eu.battle.net/api/wow/realm/status?jsonp=JSON_CALLBACK");return b.all([d,e])}}}]),simpleArmoryServices.factory("AchievementsService",["$http","$log","LoginService","$routeParams",function(a,b,c,d){function e(a,c){var d={},e={},f=0,g=0,h=0;return b.log("Parsing achievements.json..."),angular.forEach(c.achievements.achievementsCompleted,function(a,b){e[a]=c.achievements.achievementsCompletedTimestamp[b]}),angular.forEach(a,function(a){var b=0,i=0;d[a.name]={},d[a.name].categories=[],angular.forEach(a.cats,function(j){var k={name:j.name,zones:[]};angular.forEach(j.zones,function(d){var j={name:d.name,achievements:[]};angular.forEach(d.achs,function(d){var k=d,l=!1;k.completed=e[d.id],e[d.id]&&(l=!0,j.achievements.push(k),"Feats of Strength"===a.name&&h++),"Feats of Strength"===a.name||!d.obtainable||""!==d.side&&d.side!==c.faction||(b++,f++,e[d.id]&&(i++,g++),l||j.achievements.push(k))}),j.achievements.length>0&&k.zones.push(j)}),d[a.name].categories.push(k)}),d[a.name].possible=b,d[a.name].completed=i,"Feats of Strength"===a.name&&(d[a.name].foSTotal=h)}),d.possible=f,d.completed=g,d}return{getAchievements:function(){return c.getCharacter({region:d.region,realm:d.realm,character:d.character}).then(function(b){return a.get("data/achievements.json",{cache:!0}).then(function(a){return e(a.data.supercats,b[0])})})}}}]),simpleArmoryServices.factory("MountsAndPetsService",["$http","$log","LoginService","$routeParams",function(a,b,c,d){function e(a,b,c,d){var e={categories:[]},f={},g=0,h=0;return angular.forEach(b[c].collected,function(a){f[a[d]]=a}),angular.forEach(a,function(a){var c={name:a.name,subCategories:[]};e.categories.push(c),angular.forEach(a.subcats,function(a){var e={name:a.name,items:[]};angular.forEach(a.items,function(a){var c=a;if(c.spellId=a.spellid,delete c.spellid,f[c[d]]){var i=f[c[d]];if(c.collected=!0,g++,i.qualityId){var j="";switch(i.qualityId){case 0:j="poor";break;case 1:j="common";break;case 2:j="uncommon";break;case 3:j="rare";break;case 4:j="epic";break;case 5:j="legendary"}c.quality=j}if(i.stats){if(i.stats.breedId){var k="";switch(i.stats.breedId){case 4:case 14:k="P/P";break;case 5:case 15:k="S/S";break;case 6:case 16:k="H/H";break;case 7:case 17:k="H/P";break;case 8:case 18:k="P/S";break;case 9:case 19:k="H/S";break;case 10:case 20:k="P/B";break;case 11:case 21:k="S/B";break;case 12:case 22:k="H/B";break;case 3:case 13:k="B/B"}c.breed=k}c.level=i.stats.level}}var l="spell="+c.spellId;a.itemId?l="item="+a.itemId:a.allianceId&&"A"===b.faction?l="item="+a.allianceId:a.hordeId&&"H"===b.faction?l="item="+a.hordeId:a.creatureId&&(l="npc="+a.creatureId),c.link=l;var m=c.collected,n=m||a.obtainable;if(a.allowableRaces.length>0){var o=!1;angular.forEach(a.allowableRaces,function(a){a===b.race&&(o=!0)}),o||(n=!1)}if(a.allowableClasses&&a.allowableClasses.length>0){var p=!1;angular.forEach(a.allowableClasses,function(a){a===b.class&&(p=!0)}),p||(n=!1)}n&&(e.items.push(c),h++)}),e.items.length>0&&c.subCategories.push(e)})}),e.collected=g,e.possible=h,e}return{getItems:function(f,g,h){return c.getCharacter({region:d.region,realm:d.realm,character:d.character}).then(function(c){return a.get("data/"+f+".json",{cache:!0,isArray:!0}).then(function(a){return b.log("Parsing "+f+".json..."),e(a.data,c[0],g,h)})})}}}]);